@using MudBlazor
@using CastlePlus2.Contracts.DTOs.Rdzen

<MudDialog>
    <DialogContent>
        <MudForm @ref="_form">

            <MudText Typo="Typo.h6" Class="mb-3">
                @(_isEdit ? "Edycja adresu" : "Nowy adres")
            </MudText>

            <MudGrid Spacing="2">
                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Kraj"
                                  Label="Kraj"
                                  Required="true"
                                  RequiredError="Kraj jest wymagany"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Wojewodztwo"
                                  Label="Województwo"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Powiat"
                                  Label="Powiat"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Gmina"
                                  Label="Gmina"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Miejscowosc"
                                  Label="Miejscowość"
                                  Required="true"
                                  RequiredError="Miejscowość jest wymagana"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Ulica"
                                  Label="Ulica"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.Numer"
                                  Label="Numer"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField @bind-Value="Model.KodPocztowy"
                                  Label="Kod pocztowy"
                                  Margin="Margin.Dense" />
                </MudItem>

                <MudItem xs="12">
                    <MudTextField @bind-Value="Model.AdresPelny"
                                  Label="Adres pełny (opcjonalnie)"
                                  Lines="3"
                                  Margin="Margin.Dense" />
                </MudItem>

                @if (_isEdit)
                {
                    <MudItem xs="12">
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            IdAdresu: @Model.IdAdresu
                        </MudText>
                    </MudItem>
                }
            </MudGrid>

        </MudForm>
    </DialogContent>

    <DialogActions>
        <MudButton Variant="Variant.Text"
                   OnClick="Cancel">
            Anuluj
        </MudButton>

        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   OnClick="SaveAsync">
            Zapisz
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public AdresDto Model { get; set; } = new();
    [Parameter] public bool IsEdit { get; set; }

    private MudForm? _form;
    private bool _isEdit => IsEdit;

    private void Cancel() => MudDialog.Cancel();

    private async Task SaveAsync()
    {
        if (_form is null)
            return;

        await _form.Validate();

        if (!_form.IsValid)
            return;

        // Minimalna normalizacja (bez narzucania logiki domenowej)
        if (string.IsNullOrWhiteSpace(Model.Kraj))
            Model.Kraj = "Polska";

        MudDialog.Close(DialogResult.Ok(Model));
    }
}
